<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>�������� | rtoheaven&#39;s blog</title>
  <meta name="author" content="rtoheaven">
  
  <meta name="description" content="Walk steps step by step">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="rtoheaven&#39;s blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="rtoheaven&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">rtoheaven&#39;s blog</a></h1>
  <h2><a href="/">Walk steps step by step</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title category">��������</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-11-05T03:31:56.000Z"><a href="/2014/11/05/C语言操作SQLITE3数据库/">11月 5 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/05/C语言操作SQLITE3数据库/">windows����������</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="һ���汾">һ���汾</h2>
<p>�� www.sqlite.org ��վ�����ص����µ� sqlite �����ͱ����汾����д������ʱ�����´����� 3.3.17 �汾��<br>�ܾ�û��ȥ���� sqlite �´��룬����Ҳ��֪�� sqlite �仯��ô������ǰ�ܶ��ļ�������ȫ���ϲ���һ�� sqlite3.c �ļ���<br>���������ô��ļ�����ͦ�õģ�ʡȥ����һ���ļ���������û����©������Ҳ����һ�����⣺���ļ�̫�󣬿��ӽ�7���д��룬VC�������������������� �ˡ�<br>��������Ҫ�������룬Ҳ�Ͳ���Ҫ���� sqlite3.c �ļ������󲻻��������ǣ�������Ҫдͨ���޸� sqlite �������ɼ��ܹ��ܣ���ʱ���ͱȽ�ʹ���ˡ�</p>
<h2 id="������������">������������</h2>
<p>����������˵�ˣ��� VC ���½� dos ����̨�հ׹��̣��� sqlite3.c �� sqlite3.h ���ӵ����̣����½�һ�� main.cpp �ļ���������д:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">extern</span> ��C��</div><div class="line">{</div><div class="line"><span class="preprocessor">#include ��./sqlite3.h��</span></div><div class="line">};</div><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span>** )</div><div class="line">{</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>ΪʲôҪ extern ��C�� ���������������⣬�Ҳ���˵̫�࣬����C++�Ļ�����Ҫ�� C++ ��ʹ��һ�� C �Ĵ��룬����Ҫ�� extern ��C�� ��������<br>C++�� C��Ȼ�﷨�����ص�������������������ͬ�Ķ������ڴ����Ĳ�������ȫ��ͬ�ģ���C++�������ﲻ��extern ��C������C���룬�ᵼ�±�������֪��������Ϊ C ���������ڴ沼�֡�<br>������ sqlite3.c ���˼��Ѿ������δ��붼 extern ��C�� �������ˣ�����������һ�� .c �ļ����Ծ�������һ�Σ�Ҳûʲô���á�<br>�������̾��������������ˡ����룬����ͨ����������һ�ѵ� warning�����Բ�������</p>
<h2 id="����SQLITE��������">����SQLITE��������</h2>
<p>sqlite�ṩ����һЩC�����ӿڣ�����������Щ�����������ݿ⡣ͨ��ʹ����Щ�ӿڣ�����һЩ��׼ sql ���䣨�� char * ���ͣ��� sqlite ������sqlite �ͻ�Ϊ���������ݿ⡣<br>sqlite ��MS��accessһ�����ļ������ݿ⣬����˵��һ�����ݿ�����һ���ļ��������ݿ������Խ����ܶ��ı����Խ����������������ȵȣ����ǣ���ʵ���ϵõ��ľ���һ���ļ���<br>���������ļ��ͱ������������ݿ⡣sqlite ����Ҫ�κ����ݿ����棬����ζ����������Ҫ sqlite ������һЩ�û����ݣ�����������Ҫ��װ���ݿ⡣<br>���濪ʼ�������ݿ�����������</p>
<h3 id="1_�������̣�1���ؼ����ݽṹ">1 �������̣�1���ؼ����ݽṹ</h3>
<p>sqlite ����õ�����sqlite3 <em> ���͡������ݿ��򿪿�ʼ��sqlite��ҪΪ��������׼�����ڴ棬ֱ�����ݿ��رգ��������̶���Ҫ�õ���������.<br>�����ݿ�����ʱ��ʼ���������͵ı����ʹ�������Ҫ���������ݿ⡣��������ϸ���ܡ�<br>��2���������ݿ�<br>int sqlite3_open( �ļ���, sqlite3 <em>* );<br>������������ʼ���ݿ�������<br>��Ҫ��������������һ�����ݿ��ļ��������磺c:\DongChunGuang_Database.db��<br>�ļ�������Ҫһ�����ڣ��������ļ������ڣ�sqlite ���Զ������������������ڣ��ͳ��԰��������ݿ��ļ����򿪡�<br>sqlite3 </em></em> ������ǰ���ᵽ�Ĺؼ����ݽṹ�������ṹ�ײ�ϸ�����Σ��㲻Ҫ������<br>��������ֵ��ʾ�����Ƿ���ȷ��������SQLITE_OK ����ʾ�������������صķ���ֵsqlite������һЩ�ꡣ������Щ���ĺ������Բο� sqlite3.h �ļ���<br>��������ϸ���壨˳��˵һ�£�sqlite3 �Ĵ���ע�����Գ��Ƿǳ��ߵģ�ʵ����Ҳ��ȷ�ܸߡ�ֻҪ���ῴӢ�ģ�sqlite ��������ѧ�����ٶ��󣩡�<br>�������ܹر����ݿ������ٸ�һ�βο����롣<br>��3���ر����ݿ�</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> sqlite3_close(sqlite3 *);</div><div class="line">ǰ�������� sqlite3_open ������һ�����ݿ⣬��βʱ��Ҫ���������������ر����ݿ⡣</div><div class="line">�������μ򵥵Ĵ��룺</div><div class="line"><span class="keyword">extern</span> ��C��</div><div class="line">{</div><div class="line"><span class="preprocessor">#include ��./sqlite3.h��</span></div><div class="line">};</div><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span>** )</div><div class="line">{</div><div class="line">sqlite3 * db = NULL; <span class="comment">//����sqlite�ؼ��ṹָ��</span></div><div class="line"><span class="keyword">int</span> result;</div><div class="line"></div><div class="line"><span class="comment">//�������ݿ�</span></div><div class="line"><span class="comment">//��Ҫ���� db ����ָ����ָ�룬��Ϊ sqlite3_open ����ҪΪ����ָ�������ڴ棬��Ҫ��dbָ��ָ�������ڴ���</span></div><div class="line">result = sqlite3_open( ��c:\\Dcg_database.db��, &db );</div><div class="line"><span class="keyword">if</span>( result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="comment">//���ݿ�����ʧ��</span></div><div class="line"><span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">}</div><div class="line"><span class="comment">//���ݿ���������</span></div><div class="line"><span class="comment">//��</span></div><div class="line"></div><div class="line"><span class="comment">//���ݿ��򿪳ɹ�</span></div><div class="line"><span class="comment">//�ر����ݿ�</span></div><div class="line">sqlite3_close( db );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>������һ�����ݿ��������̡�</p>
<h3 id="2_SQL��������">2 SQL��������</h3>
<p>���ڽ���������sqlite ִ�б�׼ sql �﷨��</p>
<p>��1��ִ��sql����</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> sqlite3_exec(sqlite3*, <span class="keyword">const</span> <span class="keyword">char</span> *sql, sqlite3_callback, <span class="keyword">void</span> *,  <span class="keyword">char</span> **errmsg );</div><div class="line">������ִ��һ�� sql �����ĺ�����</div><div class="line">��<span class="number">1</span>����������˵�ˣ���ǰ��open�����õ���ָ�롣˵���ǹؼ����ݽṹ��</div><div class="line">��<span class="number">2</span>������<span class="keyword">const</span> <span class="keyword">char</span> *sql ��һ�� sql ���䣬��\<span class="number">0</span>��β��</div><div class="line">��<span class="number">3</span>������sqlite3_callback �ǻص󣬵���������ִ��֮����sqlite3��ȥ�������ṩ��������������ʲô�ǻص��������Լ��ұ�������ѧϰ��</div><div class="line">��<span class="number">4</span>������<span class="keyword">void</span> * �������ṩ��ָ�룬�����Դ����κ�һ��ָ����������������������ջᴫ���ص��������棬��������Ҫ����ָ�����ص�������������NULL��</div><div class="line">���������ٿ��ص�������д�����Լ�����������ʹ�á�</div><div class="line">�� <span class="number">5</span>������<span class="keyword">char</span> ** errmsg �Ǵ�����Ϣ��ע����ָ����ָ�롣</div><div class="line">sqlite3�����кܶ��̶��Ĵ�����Ϣ��ִ�� sqlite3_exec ֮����ִ��ʧ��ʱ���Բ�������ָ�루ֱ�� <span class="built_in">printf</span>(��%s\n��,errmsg)���õ�һ���ַ�����Ϣ���⴮��Ϣ����������ʲô�ط���</div><div class="line">sqlite3_exec����ͨ���޸��㴫����ָ����ָ �룬�����ṩ��ָ��ָ��������ʾ��Ϣ������sqlite3_exec���������Ϳ���ͨ������ <span class="keyword">char</span>*�õ�����������ʾ��</div><div class="line">˵����ͨ����sqlite3_callback ���������� <span class="keyword">void</span> * ������λ�ö������� NULL��</div><div class="line">��NULL��ʾ�㲻��Ҫ�ص󡣱������� insert �������� <span class="keyword">delete</span> ���󣬾�û�б�Ҫʹ�ûص󡣶������� select ʱ����Ҫʹ�ûص�����Ϊ sqlite3 �����ݲ���������ͨ���ص�������������ʲô���ݡ�</div></pre></td></tr></table></figure>

<p>��2��exec �Ļص�</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> (*sqlite3_callback)(<span class="keyword">void</span>*,<span class="keyword">int</span>,<span class="keyword">char</span>**, <span class="keyword">char</span>**);</div><div class="line">���Ļص��������붨���������������������͡����������򵥵����ӣ�</div><div class="line"><span class="comment">//sqlite3�Ļص�����</span></div><div class="line"><span class="comment">// sqlite ÿ�鵽һ����¼���͵���һ�������ص�</span></div><div class="line"><span class="keyword">int</span> LoadMyInfo( <span class="keyword">void</span> * para, <span class="keyword">int</span> n_column, <span class="keyword">char</span> ** column_value, <span class="keyword">char</span> ** column_name )</div><div class="line">{</div><div class="line"><span class="comment">//para������ sqlite3_exec �ﴫ���� void * ����</span></div><div class="line"><span class="comment">//ͨ��para�����������Դ���һЩ������ָ�루������ָ�롢�ṹָ�룩��Ȼ����������ǿ��ת���ɶ�Ӧ�����ͣ���������void*���ͣ�����ǿ��ת�����������Ͳſ��ã���Ȼ��������Щ����</span></div><div class="line"><span class="comment">//n_column����һ����¼�ж��ٸ��ֶ� (��������¼�ж�����)</span></div><div class="line"><span class="comment">// char ** column_value �Ǹ��ؼ�ֵ�������������ݶ������������ʵ�����Ǹ�1ά���飨��Ҫ��Ϊ��2ά���飩��ÿһ��Ԫ�ض���һ�� char * ֵ����һ���ֶ����ݣ����ַ�������ʾ����\0��β��</span></div><div class="line"></div><div class="line"><span class="comment">//char ** column_name �� column_value�Ƕ�Ӧ�ģ���ʾ�����ֶε��ֶ�����</span></div><div class="line"></div><div class="line"><span class="comment">//����Ҳ�ʹ�� para �������������Ĵ���.</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> i;</div><div class="line"></div><div class="line"><span class="built_in">printf</span>( ����¼���� %d ���ֶ�\n��, n_column );</div><div class="line"><span class="keyword">for</span>( i = <span class="number">0</span> ; i &lt; n_column; i ++ )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ���ֶ���:%s  ?&gt; �ֶ�ֵ:%s\n��,  column_name[i], column_value[i] );</div><div class="line">}</div><div class="line"><span class="built_in">printf</span>( ��������������\n�� );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span> ** )</div><div class="line">{</div><div class="line">sqlite3 * db;</div><div class="line"><span class="keyword">int</span> result;</div><div class="line"><span class="keyword">char</span> * errmsg = NULL;</div><div class="line"></div><div class="line">result = sqlite3_open( ��c:\\Dcg_database.db��, &db );</div><div class="line"><span class="keyword">if</span>( result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="comment">//���ݿ�����ʧ��</span></div><div class="line"><span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//���ݿ���������</span></div><div class="line"><span class="comment">//����һ�����Ա������� MyTable_1����2���ֶΣ� ID �� name������ID��һ���Զ����ӵ����ͣ��Ժ�insertʱ���Բ�ȥָ�������ֶΣ������Լ���0��ʼ����</span></div><div class="line">result = sqlite3_exec( db, ��create table MyTable_1( ID integer primary key autoincrement, name nvarchar(<span class="number">32</span>) )��, NULL, NULL, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//����һЩ��¼</span></div><div class="line">result = sqlite3_exec( db, ��insert into MyTable_1( name ) values ( ����·�� )��, <span class="number">0</span>, <span class="number">0</span>, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������¼ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line">result = sqlite3_exec( db, ��insert into MyTable_1( name ) values ( ���ﵥ���� )��, <span class="number">0</span>, <span class="number">0</span>, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������¼ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line">result = sqlite3_exec( db, ��insert into MyTable_1( name ) values ( ���������� )��, <span class="number">0</span>, <span class="number">0</span>, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������¼ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//��ʼ��ѯ���ݿ�</span></div><div class="line">result = sqlite3_exec( db, ��select * from MyTable_1��, LoadMyInfo, NULL, errmsg );</div><div class="line"></div><div class="line"><span class="comment">//�ر����ݿ�</span></div><div class="line">sqlite3_close( db );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>ͨ�����������ӣ�Ӧ�ÿ���֪�����δ���һ�����ݿ⣬���������ݿ�����������<br>����Щ֪ʶ�������Ͽ���Ӧ���ܶ����ݿ������ˡ�</p>
<h3 id="��3����ʹ�ûص���ѯ���ݿ�">��3����ʹ�ûص���ѯ���ݿ�</h3>
<p>�������ܵ� sqlite3_exec ��ʹ�ûص���ִ�� select ���󡣻���һ�򷽷�����ֱ�Ӳ�ѯ������Ҫ�ص���<br>���ǣ��Ҹ��˸о����ǻص��ã���Ϊ�������Ը������룬ֻ�����ûص����鷳����������һ�������������������� ������Ա�������㻹���ò����������� static ��<br>��Ҫ��Ϊʲô��������C++�����ˡ�C++��Ա����ʵ����������һ��������this��C++�������ĳ�Ա������ʱ������������ָ�뵱�ɺ����ĵ�һ������ ���ݽ�ȥ��<br>�����������ɸ�ǰ��˵�� sqlite �ص������Ĳ�����������ֻ�е��ѳ�Ա���������� static ʱ������û�ж�����������this��������<br>��Ȼ�ص��Եô������룬����ʱ���㻹����Ҫ�ǻص��� select ��ѯ��������ͨ�� sqlite3_get_table �����򵽡�<br>int sqlite3_get_table(sqlite3<em>, const char </em>sql, char <strong><em>resultp, int </em>nrow, int *ncolumn, char </strong>errmsg );<br>��1���������ٶ�˵����ǰ�������ӡ�<br>��2�������� sql ���䣬�� sqlite3_exec ���� sql ��һ���ġ���һ������ͨ����\0��β��char *�ַ�����<br>��3�������ǲ�ѯ����������Ȼһά���飨��Ҫ��Ϊ�Ƕ�ά���飬����Ҫ��Ϊ����ά���飩�����ڴ沼���ǣ���һ�����ֶ����ƣ������ǽ�������ÿ���ֶε�ֵ��������������˵�¡�<br>��4�������ǲ�ѯ����������¼�������������У���<br>��5�������Ƕ��ٸ��ֶΣ������У���<br>��6�������Ǵ�����Ϣ����ǰ��һ�������ﲻ��˵�ˡ�<br>����������������:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span> ** )</div><div class="line">{</div><div class="line">sqlite3 * db;</div><div class="line"><span class="keyword">int</span> result;</div><div class="line"><span class="keyword">char</span> * errmsg = NULL;</div><div class="line"><span class="keyword">char</span> **dbResult; <span class="comment">//�� char ** ���ͣ�����*��</span></div><div class="line"><span class="keyword">int</span> nRow, nColumn;</div><div class="line"><span class="keyword">int</span> i , j;</div><div class="line"><span class="keyword">int</span> index;</div><div class="line"></div><div class="line">result = sqlite3_open( ��c:\\Dcg_database.db��, &db );</div><div class="line"><span class="keyword">if</span>( result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="comment">//���ݿ�����ʧ��</span></div><div class="line"><span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//���ݿ���������</span></div><div class="line"><span class="comment">//����ǰ���Ѿ������� MyTable_1 ��</span></div><div class="line"><span class="comment">//��ʼ��ѯ�������� dbResult �Ѿ��� char **�������ּ���һ�� & ȡ��ַ�������ݽ�ȥ�ľͳ��� char ***</span></div><div class="line">result = sqlite3_get_table( db, ��select * from MyTable_1��, &dbResult, &nRow, &nColumn, &errmsg );</div><div class="line"><span class="keyword">if</span>( SQLITE_OK == result )</div><div class="line">{</div><div class="line"><span class="comment">//��ѯ�ɹ�</span></div><div class="line">index = nColumn; <span class="comment">//ǰ��˵�� dbResult ǰ����һ���������ֶ����ƣ��� nColumn ������ʼ��������������</span></div><div class="line"><span class="built_in">printf</span>( ���鵽%d����¼\n��, nRow );</div><div class="line"></div><div class="line"><span class="keyword">for</span>(  i = <span class="number">0</span>; i &lt; nRow ; i++ )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ���� %d ����¼\n��, i+<span class="number">1</span> );</div><div class="line"><span class="keyword">for</span>( j = <span class="number">0</span> ; j &lt; nColumn; j++ )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ���ֶ���:%s  ?&gt; �ֶ�ֵ:%s\n��,  dbResult[j], dbResult [index] );</div><div class="line">++index; <span class="comment">// dbResult ���ֶ�ֵ�������ģ��ӵ�0�������� nColumn �C 1���������ֶ����ƣ��ӵ� nColumn ������ʼ�����涼���ֶ�ֵ������һ����ά�ı���ͳ�����б�ʾ������һ����ƽ����ʽ����ʾ</span></div><div class="line">}</div><div class="line"><span class="built_in">printf</span>( ������-\n�� );</div><div class="line">}</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//������������ݿ���ѯ�Ƿ��ɹ������ͷ� char** ��ѯ������ʹ�� sqlite �ṩ�Ĺ������ͷ�</span></div><div class="line">sqlite3_free_table( dbResult );</div><div class="line"></div><div class="line"><span class="comment">//�ر����ݿ�</span></div><div class="line">sqlite3_close( db );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>����������Ϊֹ��sqlite3 �ĳ����÷����������ˡ�<br>�����ϵķ����������� sql ���䣬��ȫ����Ӧ�������������ݿ�������</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-11-05T03:31:56.000Z"><a href="/2014/11/05/C语言操作SQLITE3数据库1/">11月 5 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/05/C语言操作SQLITE3数据库1/">windows����������</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="һ���汾">һ���汾</h2>
<p>�� www.sqlite.org ��վ�����ص����µ� sqlite �����ͱ����汾����д������ʱ�����´����� 3.3.17 �汾��<br>�ܾ�û��ȥ���� sqlite �´��룬����Ҳ��֪�� sqlite �仯��ô������ǰ�ܶ��ļ�������ȫ���ϲ���һ�� sqlite3.c �ļ���<br>���������ô��ļ�����ͦ�õģ�ʡȥ����һ���ļ���������û����©������Ҳ����һ�����⣺���ļ�̫�󣬿��ӽ�7���д��룬VC�������������������� �ˡ�<br>��������Ҫ�������룬Ҳ�Ͳ���Ҫ���� sqlite3.c �ļ������󲻻��������ǣ�������Ҫдͨ���޸� sqlite �������ɼ��ܹ��ܣ���ʱ���ͱȽ�ʹ���ˡ�</p>
<h2 id="������������">������������</h2>
<p>����������˵�ˣ��� VC ���½� dos ����̨�հ׹��̣��� sqlite3.c �� sqlite3.h ���ӵ����̣����½�һ�� main.cpp �ļ���������д:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">extern</span> ��C��</div><div class="line">{</div><div class="line"><span class="preprocessor">#include ��./sqlite3.h��</span></div><div class="line">};</div><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span>** )</div><div class="line">{</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>ΪʲôҪ extern ��C�� ���������������⣬�Ҳ���˵̫�࣬����C++�Ļ�����Ҫ�� C++ ��ʹ��һ�� C �Ĵ��룬����Ҫ�� extern ��C�� ��������<br>C++�� C��Ȼ�﷨�����ص�������������������ͬ�Ķ������ڴ����Ĳ�������ȫ��ͬ�ģ���C++�������ﲻ��extern ��C������C���룬�ᵼ�±�������֪��������Ϊ C ���������ڴ沼�֡�<br>������ sqlite3.c ���˼��Ѿ������δ��붼 extern ��C�� �������ˣ�����������һ�� .c �ļ����Ծ�������һ�Σ�Ҳûʲô���á�<br>�������̾��������������ˡ����룬����ͨ����������һ�ѵ� warning�����Բ�������</p>
<h2 id="����SQLITE��������">����SQLITE��������</h2>
<p>sqlite�ṩ����һЩC�����ӿڣ�����������Щ�����������ݿ⡣ͨ��ʹ����Щ�ӿڣ�����һЩ��׼ sql ���䣨�� char * ���ͣ��� sqlite ������sqlite �ͻ�Ϊ���������ݿ⡣<br>sqlite ��MS��accessһ�����ļ������ݿ⣬����˵��һ�����ݿ�����һ���ļ��������ݿ������Խ����ܶ��ı����Խ����������������ȵȣ����ǣ���ʵ���ϵõ��ľ���һ���ļ���<br>���������ļ��ͱ������������ݿ⡣sqlite ����Ҫ�κ����ݿ����棬����ζ����������Ҫ sqlite ������һЩ�û����ݣ�����������Ҫ��װ���ݿ⡣<br>���濪ʼ�������ݿ�����������</p>
<h3 id="1_�������̣�1���ؼ����ݽṹ">1 �������̣�1���ؼ����ݽṹ</h3>
<p>sqlite ����õ�����sqlite3 <em> ���͡������ݿ��򿪿�ʼ��sqlite��ҪΪ��������׼�����ڴ棬ֱ�����ݿ��رգ��������̶���Ҫ�õ���������.<br>�����ݿ�����ʱ��ʼ���������͵ı����ʹ�������Ҫ���������ݿ⡣��������ϸ���ܡ�<br>��2���������ݿ�<br>int sqlite3_open( �ļ���, sqlite3 <em>* );<br>������������ʼ���ݿ�������<br>��Ҫ��������������һ�����ݿ��ļ��������磺c:\DongChunGuang_Database.db��<br>�ļ�������Ҫһ�����ڣ��������ļ������ڣ�sqlite ���Զ������������������ڣ��ͳ��԰��������ݿ��ļ����򿪡�<br>sqlite3 </em></em> ������ǰ���ᵽ�Ĺؼ����ݽṹ�������ṹ�ײ�ϸ�����Σ��㲻Ҫ������<br>��������ֵ��ʾ�����Ƿ���ȷ��������SQLITE_OK ����ʾ�������������صķ���ֵsqlite������һЩ�ꡣ������Щ���ĺ������Բο� sqlite3.h �ļ���<br>��������ϸ���壨˳��˵һ�£�sqlite3 �Ĵ���ע�����Գ��Ƿǳ��ߵģ�ʵ����Ҳ��ȷ�ܸߡ�ֻҪ���ῴӢ�ģ�sqlite ��������ѧ�����ٶ��󣩡�<br>�������ܹر����ݿ������ٸ�һ�βο����롣<br>��3���ر����ݿ�</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> sqlite3_close(sqlite3 *);</div><div class="line">ǰ�������� sqlite3_open ������һ�����ݿ⣬��βʱ��Ҫ���������������ر����ݿ⡣</div><div class="line">�������μ򵥵Ĵ��룺</div><div class="line"><span class="keyword">extern</span> ��C��</div><div class="line">{</div><div class="line"><span class="preprocessor">#include ��./sqlite3.h��</span></div><div class="line">};</div><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span>** )</div><div class="line">{</div><div class="line">sqlite3 * db = NULL; <span class="comment">//����sqlite�ؼ��ṹָ��</span></div><div class="line"><span class="keyword">int</span> result;</div><div class="line"></div><div class="line"><span class="comment">//�������ݿ�</span></div><div class="line"><span class="comment">//��Ҫ���� db ����ָ����ָ�룬��Ϊ sqlite3_open ����ҪΪ����ָ�������ڴ棬��Ҫ��dbָ��ָ�������ڴ���</span></div><div class="line">result = sqlite3_open( ��c:\\Dcg_database.db��, &db );</div><div class="line"><span class="keyword">if</span>( result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="comment">//���ݿ�����ʧ��</span></div><div class="line"><span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">}</div><div class="line"><span class="comment">//���ݿ���������</span></div><div class="line"><span class="comment">//��</span></div><div class="line"></div><div class="line"><span class="comment">//���ݿ��򿪳ɹ�</span></div><div class="line"><span class="comment">//�ر����ݿ�</span></div><div class="line">sqlite3_close( db );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>������һ�����ݿ��������̡�</p>
<h3 id="2_SQL��������">2 SQL��������</h3>
<p>���ڽ���������sqlite ִ�б�׼ sql �﷨��</p>
<p>��1��ִ��sql����</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> sqlite3_exec(sqlite3*, <span class="keyword">const</span> <span class="keyword">char</span> *sql, sqlite3_callback, <span class="keyword">void</span> *,  <span class="keyword">char</span> **errmsg );</div><div class="line">������ִ��һ�� sql �����ĺ�����</div><div class="line">��<span class="number">1</span>����������˵�ˣ���ǰ��open�����õ���ָ�롣˵���ǹؼ����ݽṹ��</div><div class="line">��<span class="number">2</span>������<span class="keyword">const</span> <span class="keyword">char</span> *sql ��һ�� sql ���䣬��\<span class="number">0</span>��β��</div><div class="line">��<span class="number">3</span>������sqlite3_callback �ǻص󣬵���������ִ��֮����sqlite3��ȥ�������ṩ��������������ʲô�ǻص��������Լ��ұ�������ѧϰ��</div><div class="line">��<span class="number">4</span>������<span class="keyword">void</span> * �������ṩ��ָ�룬�����Դ����κ�һ��ָ����������������������ջᴫ���ص��������棬��������Ҫ����ָ�����ص�������������NULL��</div><div class="line">���������ٿ��ص�������д�����Լ�����������ʹ�á�</div><div class="line">�� <span class="number">5</span>������<span class="keyword">char</span> ** errmsg �Ǵ�����Ϣ��ע����ָ����ָ�롣</div><div class="line">sqlite3�����кܶ��̶��Ĵ�����Ϣ��ִ�� sqlite3_exec ֮����ִ��ʧ��ʱ���Բ�������ָ�루ֱ�� <span class="built_in">printf</span>(��%s\n��,errmsg)���õ�һ���ַ�����Ϣ���⴮��Ϣ����������ʲô�ط���</div><div class="line">sqlite3_exec����ͨ���޸��㴫����ָ����ָ �룬�����ṩ��ָ��ָ��������ʾ��Ϣ������sqlite3_exec���������Ϳ���ͨ������ <span class="keyword">char</span>*�õ�����������ʾ��</div><div class="line">˵����ͨ����sqlite3_callback ���������� <span class="keyword">void</span> * ������λ�ö������� NULL��</div><div class="line">��NULL��ʾ�㲻��Ҫ�ص󡣱������� insert �������� <span class="keyword">delete</span> ���󣬾�û�б�Ҫʹ�ûص󡣶������� select ʱ����Ҫʹ�ûص�����Ϊ sqlite3 �����ݲ���������ͨ���ص�������������ʲô���ݡ�</div></pre></td></tr></table></figure>

<p>��2��exec �Ļص�</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> (*sqlite3_callback)(<span class="keyword">void</span>*,<span class="keyword">int</span>,<span class="keyword">char</span>**, <span class="keyword">char</span>**);</div><div class="line">���Ļص��������붨���������������������͡����������򵥵����ӣ�</div><div class="line"><span class="comment">//sqlite3�Ļص�����</span></div><div class="line"><span class="comment">// sqlite ÿ�鵽һ����¼���͵���һ�������ص�</span></div><div class="line"><span class="keyword">int</span> LoadMyInfo( <span class="keyword">void</span> * para, <span class="keyword">int</span> n_column, <span class="keyword">char</span> ** column_value, <span class="keyword">char</span> ** column_name )</div><div class="line">{</div><div class="line"><span class="comment">//para������ sqlite3_exec �ﴫ���� void * ����</span></div><div class="line"><span class="comment">//ͨ��para�����������Դ���һЩ������ָ�루������ָ�롢�ṹָ�룩��Ȼ����������ǿ��ת���ɶ�Ӧ�����ͣ���������void*���ͣ�����ǿ��ת�����������Ͳſ��ã���Ȼ��������Щ����</span></div><div class="line"><span class="comment">//n_column����һ����¼�ж��ٸ��ֶ� (��������¼�ж�����)</span></div><div class="line"><span class="comment">// char ** column_value �Ǹ��ؼ�ֵ�������������ݶ������������ʵ�����Ǹ�1ά���飨��Ҫ��Ϊ��2ά���飩��ÿһ��Ԫ�ض���һ�� char * ֵ����һ���ֶ����ݣ����ַ�������ʾ����\0��β��</span></div><div class="line"></div><div class="line"><span class="comment">//char ** column_name �� column_value�Ƕ�Ӧ�ģ���ʾ�����ֶε��ֶ�����</span></div><div class="line"></div><div class="line"><span class="comment">//����Ҳ�ʹ�� para �������������Ĵ���.</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> i;</div><div class="line"></div><div class="line"><span class="built_in">printf</span>( ����¼���� %d ���ֶ�\n��, n_column );</div><div class="line"><span class="keyword">for</span>( i = <span class="number">0</span> ; i &lt; n_column; i ++ )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ���ֶ���:%s  ?&gt; �ֶ�ֵ:%s\n��,  column_name[i], column_value[i] );</div><div class="line">}</div><div class="line"><span class="built_in">printf</span>( ��������������\n�� );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span> ** )</div><div class="line">{</div><div class="line">sqlite3 * db;</div><div class="line"><span class="keyword">int</span> result;</div><div class="line"><span class="keyword">char</span> * errmsg = NULL;</div><div class="line"></div><div class="line">result = sqlite3_open( ��c:\\Dcg_database.db��, &db );</div><div class="line"><span class="keyword">if</span>( result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="comment">//���ݿ�����ʧ��</span></div><div class="line"><span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//���ݿ���������</span></div><div class="line"><span class="comment">//����һ�����Ա������� MyTable_1����2���ֶΣ� ID �� name������ID��һ���Զ����ӵ����ͣ��Ժ�insertʱ���Բ�ȥָ�������ֶΣ������Լ���0��ʼ����</span></div><div class="line">result = sqlite3_exec( db, ��create table MyTable_1( ID integer primary key autoincrement, name nvarchar(<span class="number">32</span>) )��, NULL, NULL, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//����һЩ��¼</span></div><div class="line">result = sqlite3_exec( db, ��insert into MyTable_1( name ) values ( ����·�� )��, <span class="number">0</span>, <span class="number">0</span>, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������¼ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line">result = sqlite3_exec( db, ��insert into MyTable_1( name ) values ( ���ﵥ���� )��, <span class="number">0</span>, <span class="number">0</span>, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������¼ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line">result = sqlite3_exec( db, ��insert into MyTable_1( name ) values ( ���������� )��, <span class="number">0</span>, <span class="number">0</span>, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������¼ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//��ʼ��ѯ���ݿ�</span></div><div class="line">result = sqlite3_exec( db, ��select * from MyTable_1��, LoadMyInfo, NULL, errmsg );</div><div class="line"></div><div class="line"><span class="comment">//�ر����ݿ�</span></div><div class="line">sqlite3_close( db );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>ͨ�����������ӣ�Ӧ�ÿ���֪�����δ���һ�����ݿ⣬���������ݿ�����������<br>����Щ֪ʶ�������Ͽ���Ӧ���ܶ����ݿ������ˡ�</p>
<h3 id="��3����ʹ�ûص���ѯ���ݿ�">��3����ʹ�ûص���ѯ���ݿ�</h3>
<p>�������ܵ� sqlite3_exec ��ʹ�ûص���ִ�� select ���󡣻���һ�򷽷�����ֱ�Ӳ�ѯ������Ҫ�ص���<br>���ǣ��Ҹ��˸о����ǻص��ã���Ϊ�������Ը������룬ֻ�����ûص����鷳����������һ�������������������� ������Ա�������㻹���ò����������� static ��<br>��Ҫ��Ϊʲô��������C++�����ˡ�C++��Ա����ʵ����������һ��������this��C++�������ĳ�Ա������ʱ������������ָ�뵱�ɺ����ĵ�һ������ ���ݽ�ȥ��<br>�����������ɸ�ǰ��˵�� sqlite �ص������Ĳ�����������ֻ�е��ѳ�Ա���������� static ʱ������û�ж�����������this��������<br>��Ȼ�ص��Եô������룬����ʱ���㻹����Ҫ�ǻص��� select ��ѯ��������ͨ�� sqlite3_get_table �����򵽡�<br>int sqlite3_get_table(sqlite3<em>, const char </em>sql, char <strong><em>resultp, int </em>nrow, int *ncolumn, char </strong>errmsg );<br>��1���������ٶ�˵����ǰ�������ӡ�<br>��2�������� sql ���䣬�� sqlite3_exec ���� sql ��һ���ġ���һ������ͨ����\0��β��char *�ַ�����<br>��3�������ǲ�ѯ����������Ȼһά���飨��Ҫ��Ϊ�Ƕ�ά���飬����Ҫ��Ϊ����ά���飩�����ڴ沼���ǣ���һ�����ֶ����ƣ������ǽ�������ÿ���ֶε�ֵ��������������˵�¡�<br>��4�������ǲ�ѯ����������¼�������������У���<br>��5�������Ƕ��ٸ��ֶΣ������У���<br>��6�������Ǵ�����Ϣ����ǰ��һ�������ﲻ��˵�ˡ�<br>����������������:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span> ** )</div><div class="line">{</div><div class="line">sqlite3 * db;</div><div class="line"><span class="keyword">int</span> result;</div><div class="line"><span class="keyword">char</span> * errmsg = NULL;</div><div class="line"><span class="keyword">char</span> **dbResult; <span class="comment">//�� char ** ���ͣ�����*��</span></div><div class="line"><span class="keyword">int</span> nRow, nColumn;</div><div class="line"><span class="keyword">int</span> i , j;</div><div class="line"><span class="keyword">int</span> index;</div><div class="line"></div><div class="line">result = sqlite3_open( ��c:\\Dcg_database.db��, &db );</div><div class="line"><span class="keyword">if</span>( result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="comment">//���ݿ�����ʧ��</span></div><div class="line"><span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//���ݿ���������</span></div><div class="line"><span class="comment">//����ǰ���Ѿ������� MyTable_1 ��</span></div><div class="line"><span class="comment">//��ʼ��ѯ�������� dbResult �Ѿ��� char **�������ּ���һ�� & ȡ��ַ�������ݽ�ȥ�ľͳ��� char ***</span></div><div class="line">result = sqlite3_get_table( db, ��select * from MyTable_1��, &dbResult, &nRow, &nColumn, &errmsg );</div><div class="line"><span class="keyword">if</span>( SQLITE_OK == result )</div><div class="line">{</div><div class="line"><span class="comment">//��ѯ�ɹ�</span></div><div class="line">index = nColumn; <span class="comment">//ǰ��˵�� dbResult ǰ����һ���������ֶ����ƣ��� nColumn ������ʼ��������������</span></div><div class="line"><span class="built_in">printf</span>( ���鵽%d����¼\n��, nRow );</div><div class="line"></div><div class="line"><span class="keyword">for</span>(  i = <span class="number">0</span>; i &lt; nRow ; i++ )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ���� %d ����¼\n��, i+<span class="number">1</span> );</div><div class="line"><span class="keyword">for</span>( j = <span class="number">0</span> ; j &lt; nColumn; j++ )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ���ֶ���:%s  ?&gt; �ֶ�ֵ:%s\n��,  dbResult[j], dbResult [index] );</div><div class="line">++index; <span class="comment">// dbResult ���ֶ�ֵ�������ģ��ӵ�0�������� nColumn �C 1���������ֶ����ƣ��ӵ� nColumn ������ʼ�����涼���ֶ�ֵ������һ����ά�ı���ͳ�����б�ʾ������һ����ƽ����ʽ����ʾ</span></div><div class="line">}</div><div class="line"><span class="built_in">printf</span>( ������-\n�� );</div><div class="line">}</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//������������ݿ���ѯ�Ƿ��ɹ������ͷ� char** ��ѯ������ʹ�� sqlite �ṩ�Ĺ������ͷ�</span></div><div class="line">sqlite3_free_table( dbResult );</div><div class="line"></div><div class="line"><span class="comment">//�ر����ݿ�</span></div><div class="line">sqlite3_close( db );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>����������Ϊֹ��sqlite3 �ĳ����÷����������ˡ�<br>�����ϵķ����������� sql ���䣬��ȫ����Ӧ�������������ݿ�������</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-11-05T03:31:56.000Z"><a href="/2014/11/05/C语言操作SQLITE3数据库1/">11月 5 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/05/C语言操作SQLITE3数据库1/">windows����������</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="һ���汾">һ���汾</h2>
<p>�� www.sqlite.org ��վ�����ص����µ� sqlite �����ͱ����汾����д������ʱ�����´����� 3.3.17 �汾��<br>�ܾ�û��ȥ���� sqlite �´��룬����Ҳ��֪�� sqlite �仯��ô������ǰ�ܶ��ļ�������ȫ���ϲ���һ�� sqlite3.c �ļ���<br>���������ô��ļ�����ͦ�õģ�ʡȥ����һ���ļ���������û����©������Ҳ����һ�����⣺���ļ�̫�󣬿��ӽ�7���д��룬VC�������������������� �ˡ�<br>��������Ҫ�������룬Ҳ�Ͳ���Ҫ���� sqlite3.c �ļ������󲻻��������ǣ�������Ҫдͨ���޸� sqlite �������ɼ��ܹ��ܣ���ʱ���ͱȽ�ʹ���ˡ�</p>
<h2 id="������������">������������</h2>
<p>����������˵�ˣ��� VC ���½� dos ����̨�հ׹��̣��� sqlite3.c �� sqlite3.h ���ӵ����̣����½�һ�� main.cpp �ļ���������д:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">extern</span> ��C��</div><div class="line">{</div><div class="line"><span class="preprocessor">#include ��./sqlite3.h��</span></div><div class="line">};</div><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span>** )</div><div class="line">{</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>ΪʲôҪ extern ��C�� ���������������⣬�Ҳ���˵̫�࣬����C++�Ļ�����Ҫ�� C++ ��ʹ��һ�� C �Ĵ��룬����Ҫ�� extern ��C�� ��������<br>C++�� C��Ȼ�﷨�����ص�������������������ͬ�Ķ������ڴ����Ĳ�������ȫ��ͬ�ģ���C++�������ﲻ��extern ��C������C���룬�ᵼ�±�������֪��������Ϊ C ���������ڴ沼�֡�<br>������ sqlite3.c ���˼��Ѿ������δ��붼 extern ��C�� �������ˣ�����������һ�� .c �ļ����Ծ�������һ�Σ�Ҳûʲô���á�<br>�������̾��������������ˡ����룬����ͨ����������һ�ѵ� warning�����Բ�������</p>
<h2 id="����SQLITE��������">����SQLITE��������</h2>
<p>sqlite�ṩ����һЩC�����ӿڣ�����������Щ�����������ݿ⡣ͨ��ʹ����Щ�ӿڣ�����һЩ��׼ sql ���䣨�� char * ���ͣ��� sqlite ������sqlite �ͻ�Ϊ���������ݿ⡣<br>sqlite ��MS��accessһ�����ļ������ݿ⣬����˵��һ�����ݿ�����һ���ļ��������ݿ������Խ����ܶ��ı����Խ����������������ȵȣ����ǣ���ʵ���ϵõ��ľ���һ���ļ���<br>���������ļ��ͱ������������ݿ⡣sqlite ����Ҫ�κ����ݿ����棬����ζ����������Ҫ sqlite ������һЩ�û����ݣ�����������Ҫ��װ���ݿ⡣<br>���濪ʼ�������ݿ�����������</p>
<h3 id="1_�������̣�1���ؼ����ݽṹ">1 �������̣�1���ؼ����ݽṹ</h3>
<p>sqlite ����õ�����sqlite3 <em> ���͡������ݿ��򿪿�ʼ��sqlite��ҪΪ��������׼�����ڴ棬ֱ�����ݿ��رգ��������̶���Ҫ�õ���������.<br>�����ݿ�����ʱ��ʼ���������͵ı����ʹ�������Ҫ���������ݿ⡣��������ϸ���ܡ�<br>��2���������ݿ�<br>int sqlite3_open( �ļ���, sqlite3 <em>* );<br>������������ʼ���ݿ�������<br>��Ҫ��������������һ�����ݿ��ļ��������磺c:\DongChunGuang_Database.db��<br>�ļ�������Ҫһ�����ڣ��������ļ������ڣ�sqlite ���Զ������������������ڣ��ͳ��԰��������ݿ��ļ����򿪡�<br>sqlite3 </em></em> ������ǰ���ᵽ�Ĺؼ����ݽṹ�������ṹ�ײ�ϸ�����Σ��㲻Ҫ������<br>��������ֵ��ʾ�����Ƿ���ȷ��������SQLITE_OK ����ʾ�������������صķ���ֵsqlite������һЩ�ꡣ������Щ���ĺ������Բο� sqlite3.h �ļ���<br>��������ϸ���壨˳��˵һ�£�sqlite3 �Ĵ���ע�����Գ��Ƿǳ��ߵģ�ʵ����Ҳ��ȷ�ܸߡ�ֻҪ���ῴӢ�ģ�sqlite ��������ѧ�����ٶ��󣩡�<br>�������ܹر����ݿ������ٸ�һ�βο����롣<br>��3���ر����ݿ�</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> sqlite3_close(sqlite3 *);</div><div class="line">ǰ�������� sqlite3_open ������һ�����ݿ⣬��βʱ��Ҫ���������������ر����ݿ⡣</div><div class="line">�������μ򵥵Ĵ��룺</div><div class="line"><span class="keyword">extern</span> ��C��</div><div class="line">{</div><div class="line"><span class="preprocessor">#include ��./sqlite3.h��</span></div><div class="line">};</div><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span>** )</div><div class="line">{</div><div class="line">sqlite3 * db = NULL; <span class="comment">//����sqlite�ؼ��ṹָ��</span></div><div class="line"><span class="keyword">int</span> result;</div><div class="line"></div><div class="line"><span class="comment">//�������ݿ�</span></div><div class="line"><span class="comment">//��Ҫ���� db ����ָ����ָ�룬��Ϊ sqlite3_open ����ҪΪ����ָ�������ڴ棬��Ҫ��dbָ��ָ�������ڴ���</span></div><div class="line">result = sqlite3_open( ��c:\\Dcg_database.db��, &db );</div><div class="line"><span class="keyword">if</span>( result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="comment">//���ݿ�����ʧ��</span></div><div class="line"><span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">}</div><div class="line"><span class="comment">//���ݿ���������</span></div><div class="line"><span class="comment">//��</span></div><div class="line"></div><div class="line"><span class="comment">//���ݿ��򿪳ɹ�</span></div><div class="line"><span class="comment">//�ر����ݿ�</span></div><div class="line">sqlite3_close( db );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>������һ�����ݿ��������̡�</p>
<h3 id="2_SQL��������">2 SQL��������</h3>
<p>���ڽ���������sqlite ִ�б�׼ sql �﷨��</p>
<p>��1��ִ��sql����</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> sqlite3_exec(sqlite3*, <span class="keyword">const</span> <span class="keyword">char</span> *sql, sqlite3_callback, <span class="keyword">void</span> *,  <span class="keyword">char</span> **errmsg );</div><div class="line">������ִ��һ�� sql �����ĺ�����</div><div class="line">��<span class="number">1</span>����������˵�ˣ���ǰ��open�����õ���ָ�롣˵���ǹؼ����ݽṹ��</div><div class="line">��<span class="number">2</span>������<span class="keyword">const</span> <span class="keyword">char</span> *sql ��һ�� sql ���䣬��\<span class="number">0</span>��β��</div><div class="line">��<span class="number">3</span>������sqlite3_callback �ǻص󣬵���������ִ��֮����sqlite3��ȥ�������ṩ��������������ʲô�ǻص��������Լ��ұ�������ѧϰ��</div><div class="line">��<span class="number">4</span>������<span class="keyword">void</span> * �������ṩ��ָ�룬�����Դ����κ�һ��ָ����������������������ջᴫ���ص��������棬��������Ҫ����ָ�����ص�������������NULL��</div><div class="line">���������ٿ��ص�������д�����Լ�����������ʹ�á�</div><div class="line">�� <span class="number">5</span>������<span class="keyword">char</span> ** errmsg �Ǵ�����Ϣ��ע����ָ����ָ�롣</div><div class="line">sqlite3�����кܶ��̶��Ĵ�����Ϣ��ִ�� sqlite3_exec ֮����ִ��ʧ��ʱ���Բ�������ָ�루ֱ�� <span class="built_in">printf</span>(��%s\n��,errmsg)���õ�һ���ַ�����Ϣ���⴮��Ϣ����������ʲô�ط���</div><div class="line">sqlite3_exec����ͨ���޸��㴫����ָ����ָ �룬�����ṩ��ָ��ָ��������ʾ��Ϣ������sqlite3_exec���������Ϳ���ͨ������ <span class="keyword">char</span>*�õ�����������ʾ��</div><div class="line">˵����ͨ����sqlite3_callback ���������� <span class="keyword">void</span> * ������λ�ö������� NULL��</div><div class="line">��NULL��ʾ�㲻��Ҫ�ص󡣱������� insert �������� <span class="keyword">delete</span> ���󣬾�û�б�Ҫʹ�ûص󡣶������� select ʱ����Ҫʹ�ûص�����Ϊ sqlite3 �����ݲ���������ͨ���ص�������������ʲô���ݡ�</div></pre></td></tr></table></figure>

<p>��2��exec �Ļص�</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> (*sqlite3_callback)(<span class="keyword">void</span>*,<span class="keyword">int</span>,<span class="keyword">char</span>**, <span class="keyword">char</span>**);</div><div class="line">���Ļص��������붨���������������������͡����������򵥵����ӣ�</div><div class="line"><span class="comment">//sqlite3�Ļص�����</span></div><div class="line"><span class="comment">// sqlite ÿ�鵽һ����¼���͵���һ�������ص�</span></div><div class="line"><span class="keyword">int</span> LoadMyInfo( <span class="keyword">void</span> * para, <span class="keyword">int</span> n_column, <span class="keyword">char</span> ** column_value, <span class="keyword">char</span> ** column_name )</div><div class="line">{</div><div class="line"><span class="comment">//para������ sqlite3_exec �ﴫ���� void * ����</span></div><div class="line"><span class="comment">//ͨ��para�����������Դ���һЩ������ָ�루������ָ�롢�ṹָ�룩��Ȼ����������ǿ��ת���ɶ�Ӧ�����ͣ���������void*���ͣ�����ǿ��ת�����������Ͳſ��ã���Ȼ��������Щ����</span></div><div class="line"><span class="comment">//n_column����һ����¼�ж��ٸ��ֶ� (��������¼�ж�����)</span></div><div class="line"><span class="comment">// char ** column_value �Ǹ��ؼ�ֵ�������������ݶ������������ʵ�����Ǹ�1ά���飨��Ҫ��Ϊ��2ά���飩��ÿһ��Ԫ�ض���һ�� char * ֵ����һ���ֶ����ݣ����ַ�������ʾ����\0��β��</span></div><div class="line"></div><div class="line"><span class="comment">//char ** column_name �� column_value�Ƕ�Ӧ�ģ���ʾ�����ֶε��ֶ�����</span></div><div class="line"></div><div class="line"><span class="comment">//����Ҳ�ʹ�� para �������������Ĵ���.</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> i;</div><div class="line"></div><div class="line"><span class="built_in">printf</span>( ����¼���� %d ���ֶ�\n��, n_column );</div><div class="line"><span class="keyword">for</span>( i = <span class="number">0</span> ; i &lt; n_column; i ++ )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ���ֶ���:%s  ?&gt; �ֶ�ֵ:%s\n��,  column_name[i], column_value[i] );</div><div class="line">}</div><div class="line"><span class="built_in">printf</span>( ��������������\n�� );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span> ** )</div><div class="line">{</div><div class="line">sqlite3 * db;</div><div class="line"><span class="keyword">int</span> result;</div><div class="line"><span class="keyword">char</span> * errmsg = NULL;</div><div class="line"></div><div class="line">result = sqlite3_open( ��c:\\Dcg_database.db��, &db );</div><div class="line"><span class="keyword">if</span>( result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="comment">//���ݿ�����ʧ��</span></div><div class="line"><span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//���ݿ���������</span></div><div class="line"><span class="comment">//����һ�����Ա������� MyTable_1����2���ֶΣ� ID �� name������ID��һ���Զ����ӵ����ͣ��Ժ�insertʱ���Բ�ȥָ�������ֶΣ������Լ���0��ʼ����</span></div><div class="line">result = sqlite3_exec( db, ��create table MyTable_1( ID integer primary key autoincrement, name nvarchar(<span class="number">32</span>) )��, NULL, NULL, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//����һЩ��¼</span></div><div class="line">result = sqlite3_exec( db, ��insert into MyTable_1( name ) values ( ����·�� )��, <span class="number">0</span>, <span class="number">0</span>, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������¼ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line">result = sqlite3_exec( db, ��insert into MyTable_1( name ) values ( ���ﵥ���� )��, <span class="number">0</span>, <span class="number">0</span>, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������¼ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line">result = sqlite3_exec( db, ��insert into MyTable_1( name ) values ( ���������� )��, <span class="number">0</span>, <span class="number">0</span>, errmsg );</div><div class="line"><span class="keyword">if</span>(result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ��������¼ʧ�ܣ�������:%d������ԭ��:%s\n��, result, errmsg );</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//��ʼ��ѯ���ݿ�</span></div><div class="line">result = sqlite3_exec( db, ��select * from MyTable_1��, LoadMyInfo, NULL, errmsg );</div><div class="line"></div><div class="line"><span class="comment">//�ر����ݿ�</span></div><div class="line">sqlite3_close( db );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>ͨ�����������ӣ�Ӧ�ÿ���֪�����δ���һ�����ݿ⣬���������ݿ�����������<br>����Щ֪ʶ�������Ͽ���Ӧ���ܶ����ݿ������ˡ�</p>
<h3 id="��3����ʹ�ûص���ѯ���ݿ�">��3����ʹ�ûص���ѯ���ݿ�</h3>
<p>�������ܵ� sqlite3_exec ��ʹ�ûص���ִ�� select ���󡣻���һ�򷽷�����ֱ�Ӳ�ѯ������Ҫ�ص���<br>���ǣ��Ҹ��˸о����ǻص��ã���Ϊ�������Ը������룬ֻ�����ûص����鷳����������һ�������������������� ������Ա�������㻹���ò����������� static ��<br>��Ҫ��Ϊʲô��������C++�����ˡ�C++��Ա����ʵ����������һ��������this��C++�������ĳ�Ա������ʱ������������ָ�뵱�ɺ����ĵ�һ������ ���ݽ�ȥ��<br>�����������ɸ�ǰ��˵�� sqlite �ص������Ĳ�����������ֻ�е��ѳ�Ա���������� static ʱ������û�ж�����������this��������<br>��Ȼ�ص��Եô������룬����ʱ���㻹����Ҫ�ǻص��� select ��ѯ��������ͨ�� sqlite3_get_table �����򵽡�<br>int sqlite3_get_table(sqlite3<em>, const char </em>sql, char <strong><em>resultp, int </em>nrow, int *ncolumn, char </strong>errmsg );<br>��1���������ٶ�˵����ǰ�������ӡ�<br>��2�������� sql ���䣬�� sqlite3_exec ���� sql ��һ���ġ���һ������ͨ����\0��β��char *�ַ�����<br>��3�������ǲ�ѯ����������Ȼһά���飨��Ҫ��Ϊ�Ƕ�ά���飬����Ҫ��Ϊ����ά���飩�����ڴ沼���ǣ���һ�����ֶ����ƣ������ǽ�������ÿ���ֶε�ֵ��������������˵�¡�<br>��4�������ǲ�ѯ����������¼�������������У���<br>��5�������Ƕ��ٸ��ֶΣ������У���<br>��6�������Ǵ�����Ϣ����ǰ��һ�������ﲻ��˵�ˡ�<br>����������������:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> main( <span class="keyword">int</span> , <span class="keyword">char</span> ** )</div><div class="line">{</div><div class="line">sqlite3 * db;</div><div class="line"><span class="keyword">int</span> result;</div><div class="line"><span class="keyword">char</span> * errmsg = NULL;</div><div class="line"><span class="keyword">char</span> **dbResult; <span class="comment">//�� char ** ���ͣ�����*��</span></div><div class="line"><span class="keyword">int</span> nRow, nColumn;</div><div class="line"><span class="keyword">int</span> i , j;</div><div class="line"><span class="keyword">int</span> index;</div><div class="line"></div><div class="line">result = sqlite3_open( ��c:\\Dcg_database.db��, &db );</div><div class="line"><span class="keyword">if</span>( result != SQLITE_OK )</div><div class="line">{</div><div class="line"><span class="comment">//���ݿ�����ʧ��</span></div><div class="line"><span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//���ݿ���������</span></div><div class="line"><span class="comment">//����ǰ���Ѿ������� MyTable_1 ��</span></div><div class="line"><span class="comment">//��ʼ��ѯ�������� dbResult �Ѿ��� char **�������ּ���һ�� & ȡ��ַ�������ݽ�ȥ�ľͳ��� char ***</span></div><div class="line">result = sqlite3_get_table( db, ��select * from MyTable_1��, &dbResult, &nRow, &nColumn, &errmsg );</div><div class="line"><span class="keyword">if</span>( SQLITE_OK == result )</div><div class="line">{</div><div class="line"><span class="comment">//��ѯ�ɹ�</span></div><div class="line">index = nColumn; <span class="comment">//ǰ��˵�� dbResult ǰ����һ���������ֶ����ƣ��� nColumn ������ʼ��������������</span></div><div class="line"><span class="built_in">printf</span>( ���鵽%d����¼\n��, nRow );</div><div class="line"></div><div class="line"><span class="keyword">for</span>(  i = <span class="number">0</span>; i &lt; nRow ; i++ )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ���� %d ����¼\n��, i+<span class="number">1</span> );</div><div class="line"><span class="keyword">for</span>( j = <span class="number">0</span> ; j &lt; nColumn; j++ )</div><div class="line">{</div><div class="line"><span class="built_in">printf</span>( ���ֶ���:%s  ?&gt; �ֶ�ֵ:%s\n��,  dbResult[j], dbResult [index] );</div><div class="line">++index; <span class="comment">// dbResult ���ֶ�ֵ�������ģ��ӵ�0�������� nColumn �C 1���������ֶ����ƣ��ӵ� nColumn ������ʼ�����涼���ֶ�ֵ������һ����ά�ı���ͳ�����б�ʾ������һ����ƽ����ʽ����ʾ</span></div><div class="line">}</div><div class="line"><span class="built_in">printf</span>( ������-\n�� );</div><div class="line">}</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//������������ݿ���ѯ�Ƿ��ɹ������ͷ� char** ��ѯ������ʹ�� sqlite �ṩ�Ĺ������ͷ�</span></div><div class="line">sqlite3_free_table( dbResult );</div><div class="line"></div><div class="line"><span class="comment">//�ر����ݿ�</span></div><div class="line">sqlite3_close( db );</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>����������Ϊֹ��sqlite3 �ĳ����÷����������ˡ�<br>�����ϵķ����������� sql ���䣬��ȫ����Ӧ�������������ݿ�������</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/sql����/">sql����</a><small>0</small></li>
  
    <li><a href="/categories/安全技术/">安全技术</a><small>1</small></li>
  
    <li><a href="/categories/��������/">��������</a><small>3</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2014/11/05/C语言操作SQLITE3数据库/">windows����������</a>
      </li>
    
      <li>
        <a href="/2014/11/05/C语言操作SQLITE3数据库1/">windows����������</a>
      </li>
    
      <li>
        <a href="/2014/11/05/C语言操作SQLITE3数据库1/">windows����������</a>
      </li>
    
      <li>
        <a href="/2014/10/31/windows常见反调试/">windows常见反调试</a>
      </li>
    
  </ul>
</div>


  

  

  

  

  <div class="widget tag">
<h3 class="title">Friend Site Link </h3>
<ul class="entry">
<li><a href="http://www.sec-wiki.com/" title="sec-wiki">Sec-wiki</a></li>
<li><a href="https://github.com/rtoheaven/rtoheaven.github.io.git" title="rtoheaven's Blog">Rtoheaven github</a></li>
</ul>
</div>

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 rtoheaven
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>